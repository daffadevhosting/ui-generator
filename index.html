<!DOCTYPE html>
<html lang="id-ID">

  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>UI Generator | UI Transformer - Konversi Desain ke Tailwind CSS dengan AI</title>

  <meta name="description" content="UI Transformer oleh L Y Я A: Konversi desain UI ke kode Tailwind CSS secara otomatis dengan AI. Solusi cepat untuk developer dan desainer.">

  <meta name="keywords" content="UI Transformer, AI to Tailwind CSS, konversi desain ke kode, Tailwind CSS AI, L Y Я A, otomatisasi desain, developer tools, web design">

  <meta property="og:title" content="UI Generator">
  <meta property="og:description" content="Konversi desain UI ke kode Tailwind CSS secara otomatis dengan AI. Solusi cepat untuk developer dan desainer.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="/daffadevhosting/">
  <meta property="og:image" content="/daffadevhosting/assets/images/og-image.png"> <meta property="og:site_name" content="UI Transformer">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="UI Generator">
  <meta name="twitter:description" content="Konversi desain UI ke kode Tailwind CSS secara otomatis dengan AI. Solusi cepat untuk developer dan desainer.">
  <meta name="twitter:image" content="/daffadevhosting/assets/images/og-image.png"> <meta name="twitter:creator" content="@namatwitteranda"> <link rel="canonical" href="/daffadevhosting/">

  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" as="style">
  <link rel="preload" href="/daffadevhosting/assets/css/tailwind.css" as="style">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" as="script">

  <link type="application/atom+xml" rel="alternate" href="/daffadevhosting/feed.xml" title="UI Generator" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/daffadevhosting/assets/css/tailwind.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet">
  
  <script src="https://app.sandbox.midtrans.com/snap/snap.js" data-client-key="SB-Mid-client-i2KW02MfN9duiyJ9"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=ATCHMUUU140DUFJVh2BhJ3MwEl-2YpsO1GcLx9jVt-nbLMyuLw0QIb5BxeV09py5QPG4rJ95HkX6fp7s&currency=USD"></script>
<!-- Firebase SDKs from CDN -->
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEjcpfj58QbeFXXdAwygzvuGjH6l-xgFk",
  authDomain: "glitchlab-ai.firebaseapp.com",
  projectId: "glitchlab-ai",
  appId: "1:807047215761:web:416168acd2080ab80b1d30"
};

        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Export untuk digunakan di modul lain (jika diperlukan)
        window.getAuth = () => auth;
        window.getFirestore = () => db;

const MIDTRANS_WORKER_URL = "";
</script>

</head>


    <body class="bg-[#1E1E1E] text-white font-sans h-screen flex flex-col md:flex-row overflow-hidden">
      <div id="ai-loader" class="fixed inset-0 z-50 flex items-center justify-center" style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);background-attachment: fixed;">
    <div id="ai-orb" class="lg:w-1/3 flex justify-center">
                    <div class="relative">
                        <div class="w-64 h-64 md:w-80 md:h-80 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center animate-float">
                            <div class="glassmorph w-56 h-56 md:w-72 md:h-72 rounded-full bg-slate-800/80 flex items-center justify-center">
                                <div class="text-center">
                                    <div class="inline-flex items-center mb-3">
                                        <span class="text-3xl md:text-4xl font-bold text-white high-contrast-shadow">
                                          <span style="opacity: 0;">L</span>
                                          <span style="opacity: 0;"> </span>
                                          <span style="opacity: 0;">Y</span>
                                          <span style="opacity: 0;"> </span>
                                          <span style="opacity: 0;">Я</span>
                                          <span style="opacity: 0;"> </span>
                                          <span style="opacity: 0;">A</span>
                                        </span>
                                        <span class="js-close-icon ml-2 text-red-400 text-2xl">✕</span>
                                    </div>
                                    <a href="https://daffadevhosting.github.io" target="_blank" class="inline-block mt-3 px-6 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 rounded-full text-white font-bold shadow-lg hover:shadow-xl transition duration-300">
                                        @daffadevhosting
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="absolute top-10 -right-10 w-16 h-16 bg-yellow-500/30 blur-2xl animate-pulse rounded-full"></div>
                        <div class="absolute bottom-10 -left-10 w-16 h-16 bg-purple-500/30 blur-2xl animate-pulse rounded-full"></div>
                    </div>
                </div>
</div>
<script>
const lyraText = document.querySelector(".high-contrast-shadow");
const letters = gsap.utils.toArray(lyraText.children);

gsap.to(letters, {
  opacity: 1,
  stagger: 0.2, // Delay antar animasi setiap huruf (dalam detik)
  duration: 0.8,
  ease: "power2.inOut",
  delay: 1 // Delay sebelum animasi keseluruhan dimulai
});

gsap.fromTo(
  ".js-close-icon",
  {
    x: -50, // Mulai 50 piksel di kiri posisi aslinya
    opacity: 0
  },
  {
    x: 0,     // Bergeser ke posisi aslinya (kanan)
    opacity: 1,
    duration: 0.8,
    ease: "power2.out",
    delay: 0.3 // Delay sebelum animasi ikon dimulai (opsional)
  }
);
</script>
      <div id="promo-banner" class="absolute hidden md:bottom-4 md:right-4 top-4 z-[9999] w-full max-w-2xl px-4">
  <div class="bg-gradient-to-r from-blue-800 via-purple-700 to-pink-700 text-white shadow-lg rounded-lg flex items-start sm:items-center justify-between gap-4 p-4 animate__animated animate__fadeInDown">
    <div class="flex-1 text-sm sm:text-base">
      <strong class="text-white font-semibold">🎉 Promo Juli!</strong> Upgrade ke <span class="text-yellow-300 font-bold">Pro Medium</span> hanya <span class="text-green-300 font-bold">Rp 24.000</span> dan nikmati model AI premium.
    </div>
    <button onclick="dismissPromoBanner()" class="cursor-pointer text-white hover:text-red-300 transition text-xl">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>
</div>
<script>
function showPromoBanner() {
  const banner = document.getElementById("promo-banner");
  if (banner) {
    banner.classList.remove("hidden");
    banner.classList.add("animate__fadeInUp");
  }
}

function dismissPromoBanner() {
  const banner = document.getElementById("promo-banner");
  if (banner) {
    banner.classList.add("animate__fadeOutDown");
    setTimeout(() => banner.remove(), 500);
  }
}

const lastSeen = localStorage.getItem("promoShownAt");
const now = Date.now();
if (!lastSeen || now - lastSeen > 24 * 60 * 60 * 1000) {
  setTimeout(() => {
    showPromoBanner();
    localStorage.setItem("promoShownAt", now);
  }, 30000);
}
</script>


      <aside id="sidebar" class="w-full md:w-20 bg-[#121212] p-4 flex align-center md:flex-col gap-6 border-b md:border-b-0 md:border-r border-gray-700">
  <div class="flex lg:justify-between md:justify-self-start gap-2 items-center w-full md:block">
    <h1 class="text-2xl mb-3 font-bold hidden md:block">L Y Я A</h1>
    <div class="bg-[#2A2A2A] glass text-sm rounded px-2 py-1 md:w-fit">v.2.5</div>
  
    <a href="/daffadevhosting/pricing" class="text-sm bg-pink-700 md:hidden block text-white px-3 py-1 rounded">Upgrade PRO</a>
  
  </div>
      <!-- Tombol Chat -->
      <button id="chat-toggle" class="cursor-pointer text-sm text-center text-gray-400 hover:text-blue-400 transition underline">
        <i class="fa-solid fa-comments text-2xl"></i>
      </button>
  <button onclick="openTermsModal()" title="term & faq" class="cursor-pointer text-sm text-center text-gray-400 hover:text-blue-400 transition underline">
  <i class="fa-solid fa-circle-question text-2xl"></i>
  </button>
  <a href="https://github.com/daffadevhosting/daffadevhosting/" target="_blank" title="Github" class="cursor-pointer text-sm text-center text-gray-400 hover:text-blue-400 transition underline">
    <i class="fa-brands fa-git-alt text-3xl"></i>
  </a>
  <!-- Toggle Output Panel (Mobile only) -->
  
  <button onclick="toggleOutputPanel()" class="md:hidden cursor-pointer text-sm text-center text-gray-400 hover:text-blue-400 transition underline">
    <i class="fa-solid fa-code text-2xl"></i>
  </button>
  
</aside>
<div id="model-selector"
    class="fixed z-50 bottom-20 md:left-24 left-4 right-4 md:right-auto w-auto max-w-xs bg-[#1E1E1E] backdrop-blur-md rounded-xl shadow-xl border border-gray-700 p-4 space-y-4 opacity-0 scale-95 pointer-events-none">
    <h3 class="text-white text-sm font-semibold">Pilih Model AI</h3>
    <div class="space-y-2 text-sm text-gray-300">
        <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="model" value="basic" class="accent-blue-500" checked />
            qwen1.5-0 - Element Sederhana <span class="text-yellow-500 text-xs ml-1">FREE 2x</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="model" value="medium" class="accent-blue-500" disabled />
            llama-3.2-1b - Komponen Responsive <span class="text-yellow-500 text-xs ml-1">MEDIUM</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="model" value="advanced" class="accent-blue-500" disabled />
            mistral-small-3.1 - Layout Modular <span class="text-yellow-500 text-xs ml-1">ADVANCE</span>
        </label>
        <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="model" value="expert" class="accent-blue-500" disabled />
            deepseek-r1 - Full Page Elegan <span class="text-yellow-500 text-xs ml-1">EXPERT</span>
        </label>
    </div>
    <div id="coding-mode-toggle" class="mt-4 bg-[#1E1E1E] p-3 rounded-lg border border-gray-700">
        <label class="flex items-center text-sm text-gray-300 gap-2">
            <input type="checkbox" id="enable-coding-mode" class="cursor-pointer accent-blue-500">
            Mode Coding (React, Vue, JSX)
        </label>
        <p class="text-xs text-gray-500 mt-1">Mode ini akan membuat AI merespons dengan format kode yang lebih kompleks.</p>
    </div>
    <button id="close-model-selector"
        class="cursor-pointer w-full mt-2 text-sm bg-blue-600 hover:bg-blue-700 text-white py-2 rounded shadow">Simpan</button>
</div>

<script>
const codingModeCheckbox = document.getElementById("enable-coding-mode");

    document.addEventListener("DOMContentLoaded", () => {
        const saved = localStorage.getItem("codingMode") || "off";
        codingModeCheckbox.checked = saved === "on";

        codingModeCheckbox.addEventListener("change", () => {
            localStorage.setItem("codingMode", codingModeCheckbox.checked ? "on" : "off");
        });
    });

    // --- LOGIKA BARU UNTUK MENGAKTIFKAN MODEL AI BERDASARKAN PLAN ---
    firebase.auth().onAuthStateChanged(async (user) => {
        if (user) {
            try {
                const db = firebase.firestore(); // Dapatkan instance Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();

                if (userDoc.exists) {
                    const userData = userDoc.data();
                    const userRole = userData?.role || 'basic';
                    const userPlan = userData?.plan || 'basic'; // Default 'basic' jika tidak ada plan

                    console.log(`User ${user.uid}: Role - ${userRole}, Plan - ${userPlan}`);

                    // Dapatkan semua input radio model
                    const modelRadios = document.querySelectorAll('input[name="model"]');


                    modelRadios.forEach(radio => {
                        const modelValue = radio.value;

                        // Basic selalu aktif
                        if (modelValue === 'basic') {
                            radio.disabled = false;
                        } else if (userRole === 'pro') {
                            // Jika pengguna pro, aktifkan model sesuai plan atau di bawahnya
                            switch (userPlan) {
                                case 'expert':
                                    // Jika plan expert, aktifkan SEMUA model berbayar
                                    radio.disabled = false; // <--- BARIS INI AKAN MENGAKTIFKAN SEMUA MODEL!
                                    break;
                                case 'advanced':
                                    if (modelValue === 'advanced' || modelValue === 'medium') {
                                        radio.disabled = false;
                                    } else {
                                        radio.disabled = true;
                                    }
                                    break;
                                case 'medium':
                                    if (modelValue === 'medium') {
                                        radio.disabled = false;
                                    } else {
                                        radio.disabled = true;
                                    }
                                    break;
                                default: // Jika plan pro tapi tidak terdefinisi atau basic
                                    radio.disabled = true;
                                    break;
                            }
                        } else {
                            // Jika bukan pro, semua selain basic disabled
                            radio.disabled = true;
                        }
                    });

                    // Set model yang dipilih jika user punya plan yang lebih tinggi
                    // dan model defaultnya masih basic (misal: setelah login pertama kali)
                    if (userRole === 'pro' && userPlan !== 'basic') {
                        const selectedRadio = document.querySelector(`input[name="model"][value="${userPlan}"]`);
                        if (selectedRadio) {
                            selectedRadio.checked = true;
                        }
                    }

                } else {
                    console.warn(`User document not found for ${user.uid}. Defaulting to basic role.`);
                    // Pastikan semua model berbayar disabled jika dokumen user tidak ditemukan
                    document.querySelectorAll('input[name="model"]').forEach(radio => {
                        if (radio.value !== 'basic') radio.disabled = true;
                    });
                }
            } catch (error) {
                console.error("Error fetching user data from Firestore:", error);
                // Pastikan semua model berbayar disabled jika ada error
                document.querySelectorAll('input[name="model"]').forEach(radio => {
                    if (radio.value !== 'basic') radio.disabled = true;
                });
            }
        } else {
            // Pengguna belum login atau logout
            // Pastikan semua model berbayar disabled
            document.querySelectorAll('input[name="model"]').forEach(radio => {
                if (radio.value !== 'basic') radio.disabled = true;
            });
            // Pastikan basic tetap aktif
            document.querySelector('input[name="model"][value="basic"]').checked = true;
            document.querySelector('input[name="model"][value="basic"]').disabled = false;
        }
    });
    // --- AKHIR LOGIKA BARU ---

    async function sendPrompt(prompt, selectedModelId) {
        const isCodingMode = localStorage.getItem("codingMode") === "on";

        try {
            const res = await fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    prompt,
                    model: selectedModelId,
                    mode: "initial",
                    coding: isCodingMode // ✅ dikirim ke backend
                })
            });

            const data = await res.json();
            console.log("✅ AI Response:", data.output);
            return data.output;
        } catch (err) {
            console.error("❌ Error:", err.message);
        }
    }
</script>


      <main class="glassmorph flex-1 flex flex-col overflow-hidden">
        <div id="topbar" class="flex items-center justify-between p-4 border-b border-gray-700">
  <div class="text-sm text-gray-400 truncate">
    <a href="/daffadevhosting/">
    <i class="fa-solid fa-code text-blue-400"></i>
    UI Generator <span class="font-bold text-blue-400">(L Y Я A)</span>
    </a>
  </div>
  <div class="flex items-center gap-3">
  
    <a href="/daffadevhosting/pricing" class="text-sm bg-pink-700 hidden md:block text-white px-3 py-1 rounded">Upgrade PRO</a>
    <button
      onclick="downloadHTML()"
      id="download-button"
      class="cursor-pointer md:hidden w-8 h-8 text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 text-center font-medium rounded-full text-sm p-2"
      title="Download HTML"
    >
      <i class="fa-solid fa-download"></i>
    </button>

    <button
      onclick="showPreview()"
      id="preview-button"
      class="cursor-pointer md:hidden w-8 h-8 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 text-center font-medium rounded-full text-sm p-2"
      title="Preview"
    ><i class="fa-solid fa-eye"></i></button>
  
<!-- Trigger Button -->
<button id="userButton" class="w-8 h-8 rounded-full shadow-lg cursor-pointer transition hover:ring-2 ring-blue-500">
</button>
  </div>
</div>
<script>
  const API_URL = "https://ui-transform.daffadev.workers.dev/generate";
firebase.auth().onAuthStateChanged(async (user) => {
  const btn = document.getElementById("userButton");

  if (user) {
    const photoURL = user.photoURL || '/daffadevhosting/assets/images/icons/G-icon.png';
    btn.innerHTML = `
      <img src="${photoURL}" alt="User" id="userAvatar" class="w-8 h-8 rounded-full shadow-lg cursor-pointer transition hover:ring-2 ring-blue-500">
    `;

    document.getElementById("userAvatar").addEventListener("click", () => {
      document.getElementById("userProfileModal").classList.remove("hidden");
    });

    // 🔥 Ambil token & user data dari backend
    const token = await user.getIdToken();
    const res = await fetch(API_URL, {
      method: 'POST',
      headers: { Authorization: `Bearer ${token}`, 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt: 'cek quota', model: 'basic' }),
    });
    const result = await res.json();
    renderUserProfile(result.user, res.headers.get('X-Remaining-Quota'));
  } else {
    // Belum login, tampilkan tombol login Google
    btn.innerHTML = `
      <button id="googleLoginBtn" class="cursor-pointer">
        <img src="/daffadevhosting/assets/images/icons/G-icon.png" alt="Login">
      </button>
    `;
    document.getElementById("googleLoginBtn").addEventListener("click", () => {
      document.getElementById("loginModal").classList.remove("hidden");
    });
  }
});

function renderUserProfile(user, quota) {
  if (!user) {
    console.warn("⚠️ Tidak ada user data dikirim dari backend.");
    return;
  }

  document.getElementById("profileName").textContent = user.name || "Anonim";
  document.getElementById("profileEmail").textContent = user.email || "-";
  document.getElementById("profileRole").textContent = user.role || "free";
  document.getElementById("profilePlan").textContent = user.plan || "free";
  document.getElementById("profileQuota").textContent = `Sisa kuota: ${quota !== undefined && quota !== null ? quota : "∞"}`;
  document.getElementById("profileAvatar").src = user.photoURL || "https://ui-avatars.com/api/?name=" + encodeURIComponent(user.name || "U");

}
</script>
                  <div class="flex flex-col lg:flex-row flex-1 overflow-auto scrollbar-hidden relative">
          <div id="input-panel" class="relative w-full h-full lg:w-1/2 p-4 space-y-4 overflow-auto border-b lg:border-b-0 lg:border-r border-gray-700 scrollbar-hidden">
<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
.spinner {
  width: 16px;
  height: 16px;
  border: 2px solid #3b82f6;
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
</style>
<!-- AI Thinking Box -->
 <div class="h-[25px]">
<div id="ai-reasoning-box" class="text-sm text-blue-300 font-medium hidden flex items-center gap-2 animate-pulse">
  <i class="fa-solid fa-robot"></i>
  <span id="ai-reasoning-text">AI sedang berpikir untukmu...</span>
</div>
</div>

  <div class="relative bg-[#2A2A2A] glass h-full max-h-150 md:max-h-68 overflow-x-hidden overflow-y-auto rounded-md p-4 font-mono text-sm text-gray-300 scrollbar-hidden">
  <pre class="mb-4 overflow-x-hidden text-wrap"><code id="ai-output">... (code AI response ) ...</code></pre>
    
  </div>
  <div class="sticky bottom-0 bg-[#121212] border border-gray-700 rounded-xl p-2">
  <div class="flex justify-between items-center-safe w-full">
    <p class="text-xs text-gray-400 text-left">
      Model aktif: <span id="active-model-label" class="text-green-300">llama-3.2-1b</span>
    </p>
  <button id="settings" title="Setting" class="cursor-pointer text-sm text-center text-gray-400 hover:text-blue-400 transition underline">
    <i class="fa-solid fa-gear text-2xl"></i>
  </button>
  </div>
    <div class="relative mt-2">
      <textarea id="prompt" class="w-full bg-[#2A2A2A] rounded-md px-2 py-2 text-sm text-white placeholder-gray-400" rows="3" placeholder="Masukkan instruksi desain..."></textarea>
      <button
        id="transform-button"
        class="cursor-pointer w-10 h-10 absolute bottom-3 right-2 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm p-2"
        title="Generate UI"
      ><i class="fa-solid fa-wand-magic-sparkles text-2xl"></i>
      </button>
    </div>
  </div>
</div>
<script>
  // =================================================================
  // KONFIGURASI & VARIABEL GLOBAL
  // =================================================================
  
  const greetingHTML = `<!doctype html>
<html lang="id-ID">
  <head>
    <meta charset="UTF-8">
    <title>UI Transformer by Lyra</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"><\/script>
      <style type="text/tailwindcss">
        .text-clifford {
            color: #da373d;
        }
      </style>
  </head>
    <body class="bg-gray-50 flex flex-col justify-center items-center min-h-screen text-center p-6">
      <h1 class="text-3xl font-bold text-clifford mb-2">👋 Selamat datang!</h1>
      <p class="text-gray-600 max-w-md">Tulis perintah desain atau masukkan URL website, dan aku akan bantu generate ulang tampilannya dengan Tailwind CSS ✨</p>
      <p class="text-gray-600 max-w-md">Tapi saat ini Lyra sedang dalam perbaikan dulu, jadi belum maksimal untuk bekerja dengan baik, harap maklum yaa.. 😉️</p>
    </body>
</html>`;
  
  let reasoningVisible = false;

  const MODEL_MAP = {
    basic: { name: "qwen1.5-0", id: '@cf/qwen/qwen1.5-1.8b-chat' },
    medium: { name: "llama-3.2-1b", id: '@cf/meta/llama-3.2-3b-instruct' },
    advanced: { name: "mistral-small-3.1", id: '@cf/mistral/mistral-7b-instruct-v0.2-lora' },
    expert: { name: "deepseek-r1", id: '@cf/deepseek-ai/deepseek-r1-distill-qwen-32b' }
  };

  // =================================================================
  // FUNGSI UTAMA
  // =================================================================

  /** Mengambil key model yang sedang dipilih dari form radio button */
  function getSelectedModelKey() {
    return document.querySelector('input[name="model"]:checked')?.value || "basic";
  }

  /** Memperbarui label model yang aktif di UI */
  function updateActiveModelLabel() {
    const key = getSelectedModelKey();
    const label = document.getElementById("active-model-label");
    if (label && MODEL_MAP[key]) {
      label.textContent = MODEL_MAP[key].name;
    }
  }
  
  /** Menampilkan teks dengan efek ketikan */
  function animateTyping(element, text) {
    element.textContent = "";
    let i = 0;
    const typer = setInterval(() => {
      element.textContent = text.slice(0, i) + "_";
      element.scrollTop = element.scrollHeight;
      if (i >= text.length) {
        clearInterval(typer);
        element.textContent = text;
      }
      i++;
    }, 8);
  }

  /** Ekstrak kode HTML dari balasan mentah AI */
  function extractHtmlFromMarkdownBlock(raw) {
    const match = raw.match(/```html\s*([\s\S]*?)```/);
    if (match) return match[1].trim();
    const fallback = raw.match(/<!DOCTYPE html>[\s\S]*?<\/html>/i);
    if (fallback) return fallback[0];
    const partial = raw.match(/<!DOCTYPE html>[\s\S]*$/i);
    if (partial) return partial[0];
    return "";
  }

function updateWatermark(modelId) {
  const box = document.getElementById("ai-model-watermark");
  if (!box) return;
}

  /** Mengirim request ke API backend */
async function handleTransformClick() {
  const prompt = document.getElementById("prompt").value.trim();
  const outputEl = document.getElementById("ai-output");

  if (!prompt) {
    globalAlert("Masukkan instruksi nya dulu, boss!", "info", 3000);
    return;
  }

  const modelKey = getSelectedModelKey();
  const selectedModelId = MODEL_MAP[modelKey]?.id || MODEL_MAP["basic"].id;

  // 🔄 Tampilkan loading info
  const reasonText = document.getElementById("ai-reasoning-text");
  const reasonBox = document.getElementById("ai-reasoning-box");
  const isCodingMode = localStorage.getItem("codingMode") === "on";

  if (reasonText && reasonBox) {
    reasonText.textContent = `AI ${selectedModelId.toUpperCase()} sedang bekerja untukmu...`;
    reasonBox.classList.remove("hidden");
  }

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        prompt,
        mode: "initial",
        model: selectedModelId,
        coding: isCodingMode 
      })
    });

    if (!res.ok) {
      const errData = await res.json();
      globalAlert(`${errData.error} ${errData.action || ""}`, errData.type || "error");
      return;
    }

    const data = await res.json();
    const rawOutput = data.output || data.response || "";
    const html = extractHtmlFromMarkdownBlock(rawOutput);
    if (reasonBox) reasonBox.classList.add("hidden");
    if (data.user) {
      showUserProfileModal(data.user, data.quota || "∞");
    }

    updateWatermark(selectedModelId);
    animateTyping(outputEl, html);
    renderAIOutput(html);

    const watermarkBox = document.getElementById("ai-model-watermark");

    if (watermarkBox) {
      const isFree = selectedModelId.includes("qwen");
      if (isFree) {
        watermarkBox.innerHTML = `✨ Kamu sedang menggunakan <span class="font-semibold text-blue-400">Qwen (model gratis)</span>. 
        Hasil desain lebih optimal tersedia di model Pro seperti 
        <span class="text-yellow-400">LLaMA</span>, <span class="text-orange-400">Mistral</span>, dan <span class="text-green-400">DeepSeek</span>.
        <a href="/pricing" class="underline hover:text-white ml-1">Upgrade sekarang →</a>`;
        watermarkBox.classList.remove("hidden");
      } else {
        watermarkBox.innerHTML = "";
        watermarkBox.classList.add("hidden");
      }
    }

    const promptInput = document.getElementById("prompt");
    promptInput.classList.add("opacity-50");
    setTimeout(() => {
      promptInput.value = "";
      promptInput.classList.remove("opacity-50");
    }, 300);
    document.getElementById("prompt").focus();


    } catch (err) {
      outputEl.textContent = "❌ Error saat panggil AI";
      document.getElementById("ai-reasoning-box").classList.add("hidden");
    }
}
  
  // =================================================================
  // EVENT LISTENERS & INISIALISASI
  // =================================================================
  document.addEventListener("DOMContentLoaded", () => {
    const outputEl = document.getElementById("ai-output");
    
    // Tampilkan greeting awal
    if (outputEl) animateTyping(outputEl, greetingHTML);
    
    // Inisialisasi pilihan model dari localStorage
    const savedModel = localStorage.getItem("selectedModel") || "basic";
    const radioInput = document.querySelector(`input[name="model"][value="${savedModel}"]`);
    if (radioInput) radioInput.checked = true;
    updateActiveModelLabel();

    // Listener untuk perubahan model
    document.querySelectorAll('input[name="model"]').forEach(radio => {
      radio.addEventListener("change", updateActiveModelLabel);
    });

    // Listener untuk tombol utama
    document.getElementById("transform-button").addEventListener("click", handleTransformClick);
    
    // --- Logika panel setting (GSAP) ---
    const gearBtn = document.getElementById("settings")?.parentElement;
    const modelSelector = document.getElementById("model-selector");
    const closeModelBtn = document.getElementById("close-model-selector");
    let panelVisible = false;

    function toggleModelPanel(show) {
        panelVisible = show;
        const options = {
            duration: 0.4,
            opacity: show ? 1 : 0,
            scale: show ? 1 : 0.95,
            ease: show ? "power3.out" : "power2.in",
            onComplete: () => {
                if(modelSelector) modelSelector.style.pointerEvents = show ? "auto" : "none";
            }
        };
        gsap.to(modelSelector, options);
    }
    
    gearBtn?.addEventListener("click", () => {
        gsap.fromTo(gearBtn.querySelector("i"), { rotate: 0 }, { rotate: 360, duration: 0.8, ease: "power2.inOut" });
        toggleModelPanel(!panelVisible);
    });

    closeModelBtn?.addEventListener("click", () => {
        const selectedKey = getSelectedModelKey();
        localStorage.setItem("selectedModel", selectedKey);
        toggleModelPanel(false);
    });
  });
</script>

<script>
  function toggleOutputPanel() {
    const panel = document.getElementById("output-panel");
    const isHidden = panel.classList.contains("translate-y-[100vh]");

    if (isHidden) {
      panel.classList.remove("translate-y-[100vh]", "hidden");
      panel.classList.add("translate-y-0");
    } else {
      panel.classList.remove("translate-y-0");
      panel.classList.add("translate-y-[100vh]");
      setTimeout(() => {
        panel.classList.add("hidden");
      }, 300);
    }
  }
</script>
          <div id="output-panel" class="absolute lg:static inset-x-0 bottom-0 z-50 bg-[#282c34] md:bg-transparent md:p-0 px-0 p-4 shadow-lg transform transition-transform duration-300 ease-in-out
         w-full h-[90vh] md:h-auto overflow-y-auto md:overflow-hidden hidden lg:block translate-y-[100vh] lg:translate-y-0">
  <!-- Tombol Kanan Atas -->
  <div class="fixed bottom-4 md:bottom-2 right-4 md:right-2 flex items-center gap-4 z-10">
    <button
      onclick="saveEditedOutput()"
      id="save-button"
      class="hidden bg-blue-600 hover:bg-blue-700 text-white text-sm px-4 py-2 rounded-lg shadow transition"
    ><i class="fa-solid fa-floppy-disk"></i> Simpan & Preview</button>

    <button
      onclick="toggleEditorMode()"
      id="edit-button"
      class="cursor-pointer opacity-60 w-10 h-10 text-white bg-yellow-600 hover:bg-yellow-700 focus:ring-4 focus:outline-none focus:ring-yellow-300 text-center font-medium rounded-full text-sm p-2"
      title="Edit HTML"
    ><i class="fa-solid fa-pen"></i></button>

    <button
      onclick="downloadHTML()"
      id="download-button"
      class="cursor-pointer hidden md:block opacity-60 w-10 h-10 text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:outline-none focus:ring-green-300 text-center font-medium rounded-full text-sm p-2"
      title="Download HTML"
    >
      <i class="fa-solid fa-download"></i>
    </button>

    <button
      onclick="showPreview()"
      id="preview-button"
      class="cursor-pointer hidden md:block opacity-60 w-10 h-10 text-white bg-blue-600 hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 text-center font-medium rounded-full text-sm p-2"
      title="Preview"
    ><i class="fa-solid fa-eye"></i></button>
  </div>

  <!-- Area Editor/Code -->
  <div id="output-editor" class="relative h-[90vh] md:h-[550px]">
    <!-- Code (readonly mode) -->
    <pre id="output-readonly" class="bg-[#282c34] text-sm font-mono text-green-300 md:pt-4 pt-28 p-4 h-full overflow-y-auto overflow-x-hidden min-h-100 whitespace-pre-wrap break-words hljs text-wrap transition-opacity duration-300 scrollbar-hidden"></pre>

    <!-- Textarea (edit mode) -->
    <textarea
      id="output-editable"
      class="hidden h-full w-full bg-[#1e1e1e] text-green-300 font-mono text-sm p-4 md:pt-4 pt-28 border border-gray-700 resize-vertical focus:outline-none focus:ring-2 focus:ring-blue-500"
      rows="16"
      spellcheck="false"
    ></textarea>
    <div id="ai-model-watermark" class="hidden mt-3 text-xs text-gray-400 italic"></div>
  </div>
</div>
          <!-- Fullscreen Preview Modal -->
<div id="modal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center hidden opacity-0 transition-opacity duration-300">
  <div class="relative w-full h-full md:w-[100%] md:h-[100%] rounded-xl overflow-hidden shadow-2xl border border-gray-700 bg-[#1a1a1a]">
    <iframe
      id="previewFrame"
      class="w-full h-full rounded-xl border-0"
      sandbox="allow-same-origin allow-scripts"
    ></iframe>
    <button
      onclick="closeModal()"
      class="absolute cursor-pointer top-4 right-4 z-50 bg-red-600 hover:bg-red-700 text-white text-sm rounded-full w-10 h-10 flex items-center justify-center shadow-lg"
      title="Tutup Preview"
    >
      <i class="fa-solid fa-xmark text-lg"></i>
    </button>
  </div>
</div>

<script>
let currentHTML = "";
let isEditing = false;

document.addEventListener("DOMContentLoaded", () => {
  renderAIOutput(greetingHTML);        // tampilkan sambutan
  previewFrame.srcdoc = greetingHTML;  // render di iframe
});

function renderAIOutput(htmlString) {
  currentHTML = htmlString;

  const pre = document.getElementById("output-readonly");
  const textarea = document.getElementById("output-editable");

  pre.textContent = "";
  let i = 0;

  const typer = setInterval(() => {
    pre.textContent = htmlString.slice(0, i++) + "_";
    pre.scrollTop = pre.scrollHeight;

    if (i > htmlString.length) {
      clearInterval(typer);
      pre.textContent = htmlString;
      hljs.highlightElement(pre);
    }
  }, 5);

  textarea.value = htmlString;
}

function downloadHTML() {
  const content = document.getElementById("output-editable")?.value?.trim();
  if (!content) {
    globalAlert("Belum ada konten HTML untuk disimpan!", "error", 3000);
    return;
  }

  const blob = new Blob([content], { type: "text/html" });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");

  link.href = url;
  link.download = "ui-transform.html";
  link.click();

  URL.revokeObjectURL(url);
}

// Toggle antara readonly dan editable
function toggleEditorMode() {
  isEditing = !isEditing;

  const pre = document.getElementById("output-readonly");
  const textarea = document.getElementById("output-editable");
  const saveBtn = document.getElementById("save-button");

  if (isEditing) {
    pre.classList.add("hidden");
    textarea.classList.remove("hidden");
    saveBtn.classList.remove("hidden");
  } else {
    pre.classList.remove("hidden");
    textarea.classList.add("hidden");
    saveBtn.classList.add("hidden");
  }
}

// Simpan hasil edit dan update preview
function saveEditedOutput() {
  const textarea = document.getElementById("output-editable");
  const updatedCode = textarea.value.trim();
  if (!updatedCode) return globalAlert("Isi HTML tidak boleh kosong!", "error", 3000);

  currentHTML = updatedCode;

  // Render ulang di preview dan pre
  renderAIOutput(currentHTML);
  previewFrame.srcdoc = currentHTML;

  toggleEditorMode(); // kembali ke readonly
}

  // Tombol preview modal
function showPreview() {
  const modal = document.getElementById("modal");
  const frame = document.getElementById("previewFrame");

  // Bikin ulang blob URL dari currentHTML
  const blob = new Blob([currentHTML], { type: 'text/html' });
  const blobURL = URL.createObjectURL(blob);

  // Update src iframe pakai blob
  frame.removeAttribute("srcdoc"); // clear srcdoc biar ga tabrakan
  frame.setAttribute("src", blobURL);

  // Tampilkan modal
  modal.classList.remove("hidden");
  modal.classList.remove("opacity-0");
  modal.classList.add("opacity-100");
}

function closeModal() {
  const modal = document.getElementById("modal");
  modal.classList.remove("opacity-100");
  modal.classList.add("opacity-0");

const frame = document.getElementById("previewFrame");
if (frame?.src?.startsWith("blob:")) {
  URL.revokeObjectURL(frame.src); // bersihkan memory
}

  setTimeout(() => {
    modal.classList.add("hidden");
  }, 300); // harus sama dengan durasi transition-nya
}
</script>


        </div>
              <footer class="text-sm text-center text-gray-500 py-6  border-t border-gray-700">
        &copy; 2025 UI Generator by <a href="https://daffadevhosting.github.io" target="_blank" class="font-bold text-blue-400">L Y Я A</a>. All rights reserved.
      </footer>
      </main>
        <!-- Chat Container -->
<div id="chat-container"
  class="hidden fixed sm:bottom-20 sm:right-6 sm:w-[380px] sm:h-auto sm:rounded-2xl w-screen h-screen md:top-4 md:left-24 z-[60] bg-[#1a1d22] border border-gray-700 text-white shadow-2xl backdrop-blur-md flex flex-col overflow-hidden">

  <!-- Chat Header -->
  <div class="sticky top-0 glassmorph bg-gradient-to-r from-purple-600 to-indigo-600 p-4 text-white flex items-center">
    <div class="assistant-avatar w-10 h-10 rounded-full bg-white flex items-center justify-center mr-3">
      <i class="fas fa-robot text-purple-600 text-xl"></i>
    </div>
    <div>
      <h2 class="font-bold">L Y Я A</h2>
      <p class="text-xs opacity-80">Personal Assistant</p>
    </div>
    <div class="ml-auto flex space-x-2">
      <button id="chatToggle" class="text-white cursor-pointer text-xl ml-auto">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <!-- Chat Messages -->
  <div id="output-chat" class="glass flex-1 overflow-y-auto p-4 bg-gray-50 text-gray-800"></div>

  <!-- Input Area -->
  <div class="glassmorph sticky bottom-0 border-t p-4 bg-white">
    <div class="relative">
      <input 
        id="input-chat"
        type="text" 
        placeholder="Ketik pesan Anda..." 
        class="w-full py-3 px-4 pr-12 rounded-full border text-gray-400 border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500"
      >
      <button type="submit" class="absolute right-2 top-1/2 transform -translate-y-1/2 w-8 h-8 rounded-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white flex items-center justify-center">
        <i class="fas fa-paper-plane text-sm"></i>
      </button>
    </div>
    <div class="flex justify-between mt-2 text-xs text-gray-500">
      <div>
        <button class="hover:text-purple-600"><i class="fas fa-microphone mr-1"></i> Voice</button>
      </div>
      <div>
        <button class="hover:text-purple-600"><i class="fas fa-image mr-1"></i> Gallery</button>
        <button class="hover:text-purple-600 ml-3"><i class="fas fa-attach mr-1"></i> File</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dompurify@2.3.6/dist/purify.min.js"></script>

<script>
    const BACK_URL = "https://api-ai.d-adityadwiputraramadhan.workers.dev/";

    const chatContainer = document.querySelector("#chat-container");
    const chatInput = document.querySelector("#input-chat");
    const chatMessages = document.querySelector("#output-chat");
    const sendButton = chatContainer.querySelector("button[type='submit']");

    // --- Inisialisasi & Event Listener ---
    window.addEventListener("DOMContentLoaded", () => {
        appendIntroMessage();
    });

    document.addEventListener("click", (e) => {
        const btn = e.target.closest(".command-btn");
        if (!btn) return;

        const text = btn.innerText.match(/`(.+?)`/)?.[1] || btn.innerText;
        chatInput.value = text.toLowerCase().split("→")[0].trim();
        chatInput.focus();
        if (sendButton) sendButton.click(); // Otomatis kirim setelah klik perintah
    });

    // Handle kirim & AI reply (Disesuaikan)
    chatInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter" && chatInput.value.trim()) {
            sendUserMessage(); // Panggil tanpa argumen, akan mengambil dari chatInput.value
        }
    });

    if (sendButton) {
        sendButton.addEventListener("click", () => {
            if (chatInput.value.trim()) {
                sendUserMessage(); // Panggil tanpa argumen
            }
        });
    }

    // --- Fungsi Helper untuk UI (Tidak ada perubahan di sini) ---

    function getTimeGreeting() {
        const h = new Date().getHours();
        if (h >= 4 && h < 10) return "Pagi";
        if (h >= 10 && h < 15) return "Siang";
        if (h >= 15 && h < 17) return "Sore";
        return "Malam";
    }

    function appendMessage(role, content, isLoading = false) {
        const wrapper = document.createElement("div");
        wrapper.className = `flex mb-2 ${role === "user" ? "justify-end" : "justify-start"}`;

        const now = new Date();
        const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const timeGreeting = getTimeGreeting();

        const bubble = document.createElement("div");
        bubble.className = `
            max-w-[90%] p-2 rounded-2xl shadow
            ${role === "user"
                ? "bg-purple-600 text-white rounded-br-none"
                : "message-box bg-white text-gray-800 rounded-bl-none"}
        `.trim();

        if (role === "user") {
            bubble.innerHTML = `<div class="text-sm">${content}</div>`;
        } else {
            bubble.innerHTML = `
                <div class="flex items-start mb-2">
                    <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mr-2">
                        <i class="fas fa-robot text-purple-600 text-sm"></i>
                    </div>
                    <div>
                        <div class="font-medium text-purple-800">Lyra</div>
                        <div class="text-xs text-gray-500"><i class="far fa-clock mr-1"></i> ${timeGreeting} • ${timeString}</div>
                    </div>
                </div>
                <div class="pl-10 assistant-content ${isLoading ? 'text-gray-400 animate-pulse' : ''}">
                    ${isLoading ? `<span class="typing-dot">•••</span>` : formatResponse(content)}
                </div>
            `;
        }

        wrapper.appendChild(bubble);
        chatMessages.appendChild(wrapper);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        return bubble.querySelector(".assistant-content");
    }

    function appendIntroMessage() {
        const hour = new Date().getHours();
        let greetingText = "Halo";

        if (hour >= 4 && hour < 10) greetingText = "Selamat pagi 🌤️";
        else if (hour >= 10 && hour < 15) greetingText = "Selamat siang 🌞";
        else if (hour >= 15 && hour < 17) greetingText = "Selamat sore 🌥️";
        else greetingText = "Selamat malam 🌙";

        const introHTML = `
            <div class="message-box rounded-2xl mb-4 p-2 bg-white shadow-md max-w-[90%]">
                <div class="flex items-start mb-2">
                    <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mr-2">
                        <i class="fas fa-robot text-purple-600 text-sm"></i>
                    </div>
                    <div>
                        <div class="font-medium text-purple-800">Lyra</div>
                        <div class="text-xs text-gray-500"><i class="far fa-clock mr-1"></i> Baru saja</div>
                    </div>
                </div>
                <div class="pl-10 space-y-3">
                    <p>${greetingText}! Saya <span class="font-bold text-purple-600">Lyra</span>, asisten digitalmu yang siap membantu.</p>
                    <p>Ada yang bisa Lyra bantu hari ini? Jangan ragu bertanya, ya! 😊</p>

                    <div>
                        <p class="text-sm text-gray-600 mb-2 flex items-center">
                            <i class="fas fa-compass mr-2 text-purple-500"></i>
                            Kamu bisa coba perintah ini:
                        </p>

                        <div class="space-y-2">
                            <button class="command-btn w-full text-left flex items-center py-2 px-3 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border border-purple-100 hover:shadow-md">
                                <span class="font-medium">'pricelist' → untuk lihat daftar harga</span>
                            </button>
                            <button class="command-btn w-full text-left flex items-center py-2 px-3 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border border-purple-100 hover:shadow-md">
                                <span class="font-medium">'halo' atau 'Lyra' → untuk menyapa aku</span>
                            </button>
                            <button class="command-btn w-full text-left flex items-center py-2 px-3 bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border border-purple-100 hover:shadow-md">
                                <span class="font-medium">'bantuan' → untuk panduan lengkap</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        const wrapper = document.createElement("div");
        wrapper.className = "flex justify-start";
        wrapper.innerHTML = introHTML;

        chatMessages.appendChild(wrapper);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // --- Logic Pengiriman Pesan & AI ---

    // PERBAIKAN: sendUserMessage tidak lagi menerima 'body' sebagai argumen
    async function sendUserMessage() {
        const userPrompt = chatInput.value.trim(); // Ambil nilai langsung dari input
        chatInput.value = ""; // Kosongkan input
        appendMessage("user", userPrompt); // Tampilkan pesan pengguna

        const loader = appendMessage("assistant", "", true);

        try {
            const res = await fetch(BACK_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ prompt: userPrompt }) // Hanya kirim prompt
            });

            if (!res.ok) {
                const errorData = await res.json();
                throw new Error(errorData.message || `Backend error! status: ${res.status}`);
            }

            const data = await res.json();
            const aiMessage = data?.choices?.[0]?.message;
            const aiReply = aiMessage?.content || "Maaf, Lyra tidak bisa memberikan balasan saat ini. Silakan coba lagi nanti ya! 🙏";
            const isLocalIntent = aiMessage?.is_local_intent || false;

            if (isLocalIntent) {
                const delay = Math.random() * (1500 - 500) + 500;
                await new Promise(resolve => setTimeout(resolve, delay));
            }

            loader.classList.remove("animate-pulse", "text-gray-400");
            loader.innerHTML = formatResponse(aiReply);

        } catch (err) {
            console.error("Error from backend:", err);
            loader.classList.remove("animate-pulse", "text-gray-400");
            loader.innerHTML = "❌ Terjadi kesalahan. Mohon maaf, Lyra sedang tidak bisa merespons. Silakan coba lagi nanti ya.";
        }
    }

    // --- Konfigurasi AI & Intent Detektor ---
    // Logika ini sudah dipindahkan ke backend!
    // kode INTENT_TOS_RESPONSES dan detectIntentTOS di Hapus .
    // 🤪️
    // --- Formatting Output ---
    function formatResponse(text) {
        const rawHtml = marked.parse(text);
        return DOMPurify.sanitize(rawHtml);
    }
</script>

<!-- Script -->
<script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const chatBtn = document.getElementById("chat-toggle");
  const closeBtn = document.getElementById("chatToggle");
  const chatBox = document.getElementById("chat-container");
  let isChatOpen = false;

  function openChat() {
    chatBox.classList.remove("hidden");
    gsap.fromTo(chatBox, 
      { opacity: 0, y: 100, scale: 0.95 },
      { opacity: 1, y: 0, scale: 1, duration: 0.5, ease: "back.out(1.7)" }
    );
    isChatOpen = true;
  }

  function closeChat() {
    gsap.to(chatBox, {
      opacity: 0, y: 100, scale: 0.95, duration: 0.3, ease: "power2.in",
      onComplete: () => chatBox.classList.add("hidden")
    });
    isChatOpen = false;
  }

  if (chatBtn) {
    chatBtn.addEventListener("click", () => isChatOpen ? closeChat() : openChat());
  }
  if (closeBtn) {
    closeBtn.addEventListener("click", closeChat);
  }
});
</script>

<style>
    /* Tambahkan atau sesuaikan CSS Anda untuk typing indicator */
    .typing-dot {
        display: inline-block;
        animation: typing 1.5s infinite;
    }

    .typing-dot:nth-child(2) {
        animation-delay: 0.5s;
    }

    .typing-dot:nth-child(3) {
        animation-delay: 1s;
    }

    @keyframes typing {
        0% { opacity: 0.2; }
        50% { opacity: 1; }
        100% { opacity: 0.2; }
    }
</style>

<style>
.typing-dot {
  font-size: 1.5rem;
  color: #6b7280;
}
</style>
        <div id="termsModal" class="fixed inset-0 bg-black/70 backdrop-blur-md z-50 hidden items-center justify-center p-4 animate__animated animate__fadeIn">
  <div class="bg-gradient-to-br from-gray-800 to-gray-900 text-white rounded-2xl shadow-xl border border-gray-700 max-w-3xl w-full p-4 relative animate__animated animate__zoomIn animate__faster">
    <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-700">
      <h2 class="text-3xl font-extrabold text-blue-400 drop-shadow-lg flex items-center">
        <i class="fa-solid fa-file-contract mr-3 text-blue-300"></i> Syarat & Ketentuan
      </h2>
      <button onclick="closeTermsModal()" class="cursor-pointer text-gray-400 hover:text-red-500 transition-colors duration-200 text-2xl" aria-label="Close">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <div class="space-y-8 max-h-[60vh] overflow-y-auto pr-4 custom-scrollbar">
      <div>
        <h3 class="text-xl font-bold text-yellow-300 mb-3 flex items-center">
          <i class="fa-solid fa-info-circle mr-2 text-yellow-200"></i> Ketentuan Umum
        </h3>
        <ul class="list-disc pl-8 text-base text-gray-300 space-y-3 leading-relaxed">
          <li>Layanan ini memanfaatkan kecerdasan buatan untuk menghasilkan kode <strong>HTML/React/TailwindCSS</strong> yang inovatif.</li>
          <li>Pengguna <strong>gratis</strong> mendapatkan batas 2x generasi per hari menggunakan model <strong>Qwen</strong>.</li>
          <li>Akses ke model AI yang lebih canggih seperti <strong>Mistral</strong> & <strong>DeepSeek</strong> tersedia dengan paket berbayar.</li>
          <li>Seluruh kode yang dihasilkan merupakan produk AI dan tidak bergaransi — <strong>peninjauan manual sangat disarankan</strong>.</li>
        </ul>
      </div>

      <div>
        <h3 class="text-xl font-bold text-green-300 mb-3 flex items-center">
          <i class="fa-solid fa-cogs mr-2 text-green-200"></i> Cara Menggunakan
        </h3>
        <ol class="list-decimal pl-8 text-base text-gray-300 space-y-3 leading-relaxed">
          <li>Masukkan perintah desain atau komponen yang Anda inginkan pada kolom input yang tersedia.</li>
          <li>Pilih model AI preferensi Anda melalui pengaturan (ikon gear) untuk hasil optimal.</li>
          <li>Tekan tombol <strong><i class="fa-solid fa-wand-magic-sparkles"></i></strong> dan biarkan AI kami mengerjakan magic-nya.</li>
          <li>Hasilnya akan segera muncul di panel editor; Anda bisa melihat pratinjau, mengedit, atau menyimpannya.</li>
          <li>Gunakan tombol <strong>“Download”</strong> jika Anda ingin menyimpan hasil akhir sebagai file HTML.</li>
        </ol>
      </div>

      <div class="text-sm text-gray-500 mt-6 pt-5 border-t border-gray-700 italic text-center">
        Dengan melanjutkan penggunaan layanan ini, Anda secara otomatis dianggap telah membaca dan menyetujui seluruh syarat & ketentuan yang berlaku di atas.
      </div>
    </div>

    <div class="mt-8 text-center">
      <button onclick="closeTermsModal()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-10 py-3 rounded-full shadow-lg transform transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
        Saya Mengerti & Setuju
      </button>
    </div>
  </div>
</div>

<style>
  /* Custom Scrollbar for Webkit browsers (Chrome, Safari) */
  .custom-scrollbar::-webkit-scrollbar {
    width: 10px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: #2d3748; /* Darker background for the track */
    border-radius: 10px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #4a5568; /* Slightly lighter thumb color */
    border-radius: 10px;
    border: 2px solid #2d3748; /* Border to create a "floating" effect */
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #636b77; /* Even lighter on hover */
  }

  /* Fallback for Firefox */
  .custom-scrollbar {
    scrollbar-width: thin; /* "auto" or "thin" */
    scrollbar-color: #4a5568 #2d3748; /* thumb and track color */
  }
</style>

<script>
  function openTermsModal() {
    document.getElementById('termsModal').classList.remove('hidden');
    document.getElementById('termsModal').classList.add('flex');
    // Remove previous animation classes to allow re-triggering on subsequent opens
    const modalContent = document.querySelector('#termsModal > div');
    modalContent.classList.remove('animate__fadeInDown', 'animate__zoomOut');
    modalContent.classList.add('animate__zoomIn', 'animate__faster');
  }

  function closeTermsModal() {
    const modalContent = document.querySelector('#termsModal > div');
    modalContent.classList.remove('animate__zoomIn');
    modalContent.classList.add('animate__zoomOut'); // Add zoomOut animation

    // Hide the modal after the animation completes
    modalContent.addEventListener('animationend', function handler() {
      document.getElementById('termsModal').classList.remove('flex');
      document.getElementById('termsModal').classList.add('hidden');
      modalContent.removeEventListener('animationend', handler); // Remove listener to prevent multiple calls
    });
  }

  // Optional: Close modal when clicking outside
  document.getElementById('termsModal').addEventListener('click', function(event) {
    if (event.target === this) {
      closeTermsModal();
    }
  });
</script>
        <!-- Modal Overlay -->
<div id="loginModal" class="fixed glassmorph inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
  <div class="bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white w-[90%] max-w-md p-6 rounded-2xl shadow-2xl animate-fade-in">
    <h2 class="text-xl font-bold mb-4">Masuk dengan Google</h2>
    <p class="text-sm mb-4">Silakan masuk untuk melanjutkan menggunakan layanan AI kami. Harap setujui ketentuan layanan terlebih dahulu.</p>

    <div class="flex items-center space-x-2 mb-4">
      <input type="checkbox" id="acceptTerms" class="accent-blue-500 cursor-pointer">
      <label for="acceptTerms" class="text-sm">Saya menyetujui <a href="/daffadevhosting/terms" class="underline">syarat & ketentuan</a>.</label>
    </div>

    <button id="confirmGoogleLogin" disabled class="w-full bg-blue-500 text-white py-2 px-4 rounded-xl font-semibold opacity-50 cursor-not-allowed transition-all">
      <img src="/daffadevhosting/assets/images/icons/G-icon.png" alt="Google" class="inline w-5 h-5 mr-2"> Masuk dengan Google
    </button>

    <button id="closeLoginModal" class="mt-4 w-full text-sm text-zinc-500 cursor-pointer hover:underline">Batal</button>
  </div>
</div>

<style>
@keyframes fade-in {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}
.animate-fade-in {
  animation: fade-in 0.3s ease-out;
}
</style>

<script>
const modal = document.getElementById('loginModal');
const triggerBtn = document.getElementById('googleLoginBtn');
const closeBtn = document.getElementById('closeLoginModal');
const checkbox = document.getElementById('acceptTerms');
const loginBtn = document.getElementById('confirmGoogleLogin');

closeBtn.addEventListener('click', () => {
  modal.classList.add('hidden');
});

checkbox.addEventListener('change', () => {
  if (checkbox.checked) {
    loginBtn.disabled = false;
    loginBtn.classList.remove('opacity-50', 'cursor-not-allowed');
    loginBtn.classList.add('cursor-pointer');
  } else {
    loginBtn.disabled = true;
    loginBtn.classList.add('opacity-50', 'cursor-not-allowed');
    loginBtn.classList.remove('cursor-pointer');
  }
});

loginBtn.addEventListener('click', async () => {
  if (!checkbox.checked) return;
  
  const provider = new firebase.auth.GoogleAuthProvider();
  try {
    await firebase.auth().signInWithPopup(provider);
    firebase.auth().onAuthStateChanged(async (user) => {
    if (user) {
        const token = await user.getIdToken();
        const docRef = firebase.firestore().doc(`users/${user.uid}`);
        await docRef.set({
        uid: user.uid,
        name: user.displayName || "Unknown",
        email: user.email,
        photoURL: user.photoURL,
        role: 'free',
        plan: 'free',
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });

        console.log("✅ User disimpan ke Firestore:", user.uid);
    }
    });
    modal.classList.add('hidden');
  } catch (error) {
    globalAlert('Login gagal: ' + error.message);
  }
});
</script>

        <div id="userProfileModal" class="glassmorph fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white dark:bg-zinc-900 text-zinc-900 dark:text-white w-full max-w-sm p-6 rounded-2xl shadow-2xl border border-white/20 relative overflow-hidden">

    <!-- Avatar -->
    <div class="flex flex-col items-center text-center">
      <img id="profileAvatar" src="" alt="Avatar" class="w-24 h-24 rounded-full border-4 border-white shadow-md mb-3 object-cover" />
      <h2 id="profileName" class="text-2xl font-semibold tracking-tight"></h2>
      <p id="profileEmail" class="text-sm text-zinc-400 -mt-0.5"></p>

      <!-- Badges -->
      <div class="flex gap-2 mt-2">
        <span id="profileRole" class="text-xs px-2 py-1 rounded-full bg-gradient-to-tr from-blue-500 to-purple-500 text-white font-semibold shadow-sm"></span>
        <span id="profilePlan" class="text-xs px-2 py-1 rounded-full bg-zinc-800 text-white font-semibold border border-zinc-700 shadow-sm"></span>
      </div>

      <!-- Kuota -->
      <p id="profileQuota" class="mt-4 text-sm text-zinc-300 italic"></p>

      <!-- Tombol -->
    <div class="flex justify-between items-center-safe w-full">
      <button id="loggedOut" class="cursor-pointer mt-4 bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-full text-sm transition" onclick="firebase.auth().signOut()">Keluar</button>
      <button onclick="document.getElementById('userProfileModal').classList.add('hidden')" class="cursor-pointer mt-2 text-xs text-zinc-400 hover:text-white underline transition">Tutup</button>
    </div>
    </div>
  </div>
</div>

<script>
function showUserProfileModal(user, quota = "∞") {
  if (!user) return;

  document.getElementById("userProfileModal").classList.remove("hidden");
  }
  document.getElementById("loggedOut").addEventListener("click", () => {
  document.getElementById('userProfileModal').classList.add('hidden');
});
</script>
            <!-- Global Alert Container -->
    <div id="global-alert-container" class="fixed top-4 left-1/2 -translate-x-1/2 z-[9999] w-full max-w-xl px-4 pointer-events-none"></div>
    <script>
function globalAlert(message = "Terjadi sesuatu!", type = "info", duration = 5000) {
  const icons = {
    success: "✅",
    warning: "⚠️",
    error: "❌",
    info: "💡",
  };

  const bgColors = {
    success: "from-green-700 to-green-500",
    warning: "from-yellow-600 to-yellow-400",
    error: "from-red-700 to-red-500",
    info: "from-blue-700 to-blue-500",
  };

  const icon = icons[type] || icons.info;
  const bg = bgColors[type] || bgColors.info;

  const container = document.getElementById("global-alert-container");
  if (!container) return;

  const id = "alert-" + Date.now();
  const alertEl = document.createElement("div");
  alertEl.id = id;
  alertEl.className =
    `bg-gradient-to-r ${bg} text-white shadow-xl rounded-lg flex items-start sm:items-center justify-between gap-4 p-4 mb-4 animate__animated animate__fadeInDown pointer-events-auto`;

  alertEl.innerHTML = `
    <div class="flex-1 text-sm sm:text-base">
      <strong class="font-bold">${icon}</strong>
      <span class="ml-1">${message}</span>
    </div>
    <button onclick="dismissGlobalAlert('${id}')" class="text-white hover:text-gray-300 transition text-xl">
      <i class="fa-solid fa-xmark"></i>
    </button>
  `;

  container.appendChild(alertEl);

  // Auto dismiss
  setTimeout(() => {
    dismissGlobalAlert(id);
  }, duration);
}

function dismissGlobalAlert(id) {
  const el = document.getElementById(id);
  if (el) {
    el.classList.add("animate__fadeOutUp");
    setTimeout(() => el.remove(), 500);
  }
}
</script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  setTimeout(() => {
    gsap.to("#ai-loader", {
      opacity: 0,
      duration: 1.5,
      onComplete: () => document.getElementById("ai-loader")?.remove()
    });

    const timeline = gsap.timeline({ defaults: { duration: 1.8, ease: "power3.out" } });

    const isDesktop = window.matchMedia("(min-width: 1024px)").matches;

    timeline
      .from("#topbar", { y: -80, opacity: 0 }, 0.2)
      .from("#sidebar", { y: 80, opacity: 0 }, 0.4)
      .from("#input-panel", { x: -100, opacity: 0 }, 0.6);

    if (isDesktop) {
      timeline.from("#output-panel", { x: 100, opacity: 0 }, 0.8);
    }

    timeline.from("footer", { y: 60, opacity: 0, ease: "bounce.out" }, 1.0);
  }, 3000);
});
</script>
      
    </body>
</html>
